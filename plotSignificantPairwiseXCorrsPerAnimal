function plotSignificantPairwiseXCorrsPerAnimal(matFile)
% load pairwise xc data from .mat file & filter neuron pairs w peak corrs > 3 SDs above null dist
% plot hists of peak lag and corr for only significant pairs
% this new func plots each animal separately, cortex only

% input: matFile - string path to the .mat file containing allPeakLags, allPeakCorrs, allXC_Shifted qkq plotSignificantPairwiseXCorrsPerAnimal('PairwiseCrossCorrelationResults.mat')

% load data
load(matFile, 'allPeakLags', 'allPeakCorrs', 'allXC_Shifted');

% indices
numSessions = size(allPeakCorrs, 1);
% numRegions = size(allPeakCorrs, 2); % unchanged but not needed now
cortexIdx = 1; % cortex = column 1 (cell array is 3x2: animals x [cortex, striatum])

for sess = 1:numSessions
    % initialize per-animal
    sigLagVec = [];
    sigCorrVec = [];
    allLagVec = [];
    allCorrVec = [];

    % cortex only
    reg = cortexIdx;

    peakCorrs  = allPeakCorrs{sess, reg};
    peakLags   = allPeakLags{sess, reg};
    shiftedXC  = allXC_Shifted{sess, reg};  % [int × pyr × numShifts]

    if isempty(peakCorrs) || isempty(shiftedXC)
        % nothing to plot for this animal
        continue;
    end

    [numInt, numPyr, ~] = size(shiftedXC);

    for i = 1:numInt
        for j = 1:numPyr
            % get null dist: all peak xcorrs across shifts
            nullVals = squeeze(shiftedXC(i, j, :));
            nullMean = mean(nullVals, 'omitnan');
            nullStd  = std(nullVals, 'omitnan');

            actualCorr = peakCorrs(i, j);
            actualLag  = peakLags(i, j);

            % save all vals for histogram reference
            allCorrVec(end+1) = actualCorr;
            allLagVec(end+1)  = actualLag;

            % check if significantly above null
            if ~isnan(actualCorr) && ~isnan(nullMean) && ~isnan(nullStd) && actualCorr > (nullMean + 3 * nullStd)
                sigCorrVec(end+1) = actualCorr;
                sigLagVec(end+1)  = actualLag;
            end
        end
    end

    % counts
    totalPairs = numel(allCorrVec);
    sigPairs   = numel(sigCorrVec);

    % plot: peak lag hist (per animal)
    figure;
    histogram(sigLagVec, 50, 'FaceAlpha', 0.8, 'EdgeColor', 'none');
    xlabel('Peak Lag (sec)');
    ylabel('Count');
    title(sprintf('Animal %d (Cortex) – Significant Peak Lags (n = %d / %d)', sess, sigPairs, totalPairs));
    grid on;

    % plot: peak corr hist (per animal)
    figure;
    histogram(sigCorrVec, 50, 'FaceAlpha', 0.8, 'EdgeColor', 'none');
    xlabel('Peak Correlation');
    ylabel('Count');
    title(sprintf('Animal %d (Cortex) – Significant Peak Correlations (n = %d / %d)', sess, sigPairs, totalPairs));
    grid on;
end

end
