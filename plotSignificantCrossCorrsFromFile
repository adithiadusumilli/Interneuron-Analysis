function plotSignificantCrossCorrsFromFile(matFile)
% load pairwise xc data from .mat file
% filter neuron pairs w peak corrs > 3 SDs above null dist
% plot hists of peak lag and corr for only significant pairs

% input: matFile - string path to the .mat file containing allPeakLags, allPeakCorrs, allXC_Shifted (3D matrix)
% eg plotSignificantCrossCorrsFromFile('PairwiseCrossCorrelationResults.mat')

% load data
load(matFile, 'allPeakLags', 'allPeakCorrs', 'allXC_Shifted');

% initialize
sigLagVec = [];
sigCorrVec = [];
allLagVec = [];
allCorrVec = [];

numSessions = size(allPeakCorrs, 1);
numRegions = size(allPeakCorrs, 2);

for sess = 1:numSessions
    for reg = 1:numRegions
        peakCorrs = allPeakCorrs{sess, reg};
        peakLags = allPeakLags{sess, reg};
        shiftedXC = allXC_Shifted{sess, reg};  % [int × pyr × numShifts]

        if isempty(peakCorrs) || isempty(shiftedXC)
            continue;
        end

        [numInt, numPyr, ~] = size(shiftedXC);

        for i = 1:numInt
            for j = 1:numPyr
                % get null dist: all peak xcorrs across shifts
                nullVals = squeeze(shiftedXC(i, j, :));
                nullMean = mean(nullVals, 'omitnan');
                nullStd = std(nullVals, 'omitnan');

                actualCorr = peakCorrs(i, j);
                actualLag = peakLags(i, j);

                % save all vals for histogram reference
                allCorrVec(end+1) = actualCorr;
                allLagVec(end+1) = actualLag;

                % check if significantly above null
                if ~isnan(actualCorr) && actualCorr > (nullMean + 3 * nullStd)
                    sigCorrVec(end+1) = actualCorr;
                    sigLagVec(end+1) = actualLag;
                end
            end
        end
    end
end

% counts
totalPairs = numel(allCorrVec);
sigPairs = numel(sigCorrVec);

% plot: peak lag hist
figure;
histogram(sigLagVec, 50, 'FaceAlpha', 0.8, 'EdgeColor', 'none');
xlabel('Peak Lag (sec)');
ylabel('Count');
title(sprintf('Significant Peak Lags (n = %d / %d)', sigPairs, totalPairs));
grid on;

% plot: peak corr hist
figure;
histogram(sigCorrVec, 50, 'FaceAlpha', 0.8, 'EdgeColor', 'none');
xlabel('Peak Correlation');
ylabel('Count');
title(sprintf('Significant Peak Correlations (n = %d / %d)', sigPairs, totalPairs));
grid on;

end

