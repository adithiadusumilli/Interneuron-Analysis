function mapTransitionsToBehavior(folderPath)
% mapping emg transition windows to behavior labels from umap & manual annotation
% loads transition points, maps them to the reduced time axis used for umap and manual labels
% assigns behavior values from both regionAssignmentFiltered (1-7) and behvLabelsNoArt (0-10)
% saves behavior assignments and plots histograms of transition counts per behavior type

% load transition indices (in downsampEMG time base)
load(fullfile(folderPath, 'emg_Neural_AllChannels.mat'), 'validTransitions');

% load origDownsampEMGInd (maps UMAP indices to full downsampEMG time base)
load(fullfile(folderPath, 'EMG1ms.mat'), 'origDownsampEMGInd');

% load only the necessary behavior variables from UMAP
load(fullfile(folderPath, 'UMAP.mat'), 'regionAssignmentFiltered', 'behvLabelsNoArt');

% initialize outputs with nan
regionLabelsPerTransition = nan(size(validTransitions));
manualLabelsPerTransition = nan(size(validTransitions));

% reverse map from full (~5 million) to UMAP indices (~4 million) & build lookup table (index i in full space → index in umap space)
map = nan(max(origDownsampEMGInd), 1);
map(origDownsampEMGInd) = 1:numel(origDownsampEMGInd);

% loop over each transition and find corresponding umap index
for i = 1:length(validTransitions)
    transitionIdx = validTransitions(i);
    
    % get corresponding index into umap time axis
    umapIdx = map(transitionIdx);
    
    % skip if not in umap time base
    if isnan(umapIdx), continue; end

    % get and normalize region assignment (e.g., if 33–39, make it 1–7)
    regionVal = regionAssignmentFiltered(umapIdx);
    regionLabelsPerTransition(i) = regionVal - min(regionAssignmentFiltered) + 1;

    % get manual behavior label (already 0–10, but clip just in case)
    manualVal = behvLabelsNoArt(umapIdx);
    manualLabelsPerTransition(i) = min(max(manualVal, 0), 10);
end

% save output variables
save(fullfile(folderPath, 'transitionBehaviorLabels.mat'), 'regionLabelsPerTransition', 'manualLabelsPerTransition');

% plot histogram of transitions by region behavior (1–7)
figure('Name','Transitions by UMAP Region','Color','w');
histogram(regionLabelsPerTransition, 'BinMethod','integers', 'FaceColor','b');
xlabel('umap region label (1–7)');
ylabel('# of transitions');
title('transition counts by umap region');

% plot histogram of transitions by manual behavior label (0–10)
figure('Name','Transitions by Manual Label','Color','w');
histogram(manualLabelsPerTransition, 'BinMethod','integers', 'FaceColor','g');
xlabel('manual label (0–10)');
ylabel('# of transitions');
title('transition counts by manual behavior label');
end
